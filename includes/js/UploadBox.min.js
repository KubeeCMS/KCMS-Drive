(function(e){"use strict";e.widget("cp.UseyourDriveUploadbox",{options:{standalone:!1,auto_upload:!1,restrictions:{accepted_formats:null,min_file_size:null,max_file_size:null,max_uploads:null,quota:null,has_requirements:!1},use_encryption:!1,attached_browser:null,dropzone:self.element,pre_process:!1,template_row:".fileupload-table-row-template",queue_table:".fileupload-table-body",debug:!1},_create:function(){this.options.auto_upload=1==this.element.hasClass("auto_upload")||1==this.element.hasClass("force_auto_upload"),this.options.standalone=!0===this.options.main.element.hasClass("upload"),this.options.support_xhr=e.support.xhrFileUpload&&!1===this.options.use_encryption,this.options.support_chunked=this.options.support_xhr,this.options.multipart_val=!this.options.support_xhr,this.options.method_val=this.options.support_xhr?"PUT":"POST",this.options.singlefileuploads_val=!0,this.options.maxchunksize_val=this.options.support_chunked?5242880:0,this.options.restrictions.accepted_formats=new RegExp(this.element.find('input[name="acceptfiletypes"]').val(),"i"),this.options.restrictions.min_file_size=parseInt(this.element.find('input[name="minfilesize"]').val()),this.options.restrictions.max_file_size=this.options.support_xhr&&"0"===this.element.find('input[name="maxfilesize"]').attr("data-limit")?-1:parseInt(this.element.find('input[name="maxfilesize"]').val()),this.options.restrictions.max_uploads=parseInt(this.element.find('input[name="maxnumberofuploads"]').val()),this.options.has_requirements=0!==this.element.find(".upload-requirements-content-subtitle").children().length,this.options.pre_process=1==this.element.data("preprocess"),this.options.use_encryption="1"===this.element.find('input[name="encryption"]').val(),this.options.template_row=this.element.find(this.options.template_row),this.options.queue_table=this.element.find(this.options.queue_table),this.options.dropzone=this.options.main.element,this.in_form=this.element.closest("form").length>0,this.form_element=this.element.closest("form"),this.form_submit_button=this.form_element.find('input[type="submit"]:visible, input[type="button"].gform_next_button:visible, button[id^="gform_submit_button"]:visible, button[class*="cf7md-submit-btn"]:visible, button.wpforms-submit:visible, button.wpforms-page-next:visible').not(".wpcp-upload-submit"),this.form_upload_button=null,this.block_upload_element=null,this.upload_process=null,this.pre_process=null,this.pre_process_completed=!1,this.pending_uploads={},this.finished_uploads={},this.files_storage={},this.queue=[],this.queue_length=0,this.queue_size=0,this._initiate()},_destroy:function(){return this._super()},_setOption:function(e,t){this._super(e,t)},_initiate:function(){var e=this;e._log("UPLOAD BOX: LOADED",e),e._initUploadBox(),e._initFunctions(),e._refreshView(),e._log("UPLOAD BOX: ACTIVATED",e),window.setTimeout(function(){e.initated=!0},2e3)},_initUploadBox:function(){var e=this;e.upload_box=e.element.fileupload({url:e.options.ajax_url,type:e.options.method_val,maxChunkSize:e.options.maxchunksize_val,singleFileUploads:e.options.singlefileuploads_val,multipart:e.options.multipart_val,dataType:"json",autoUpload:e.options.auto_upload,maxFileSize:e.options.restrictions.max_file_size,acceptFileTypes:e.options.restrictions.accepted_formats,dropZone:e.options.dropzone,messages:{maxNumberOfFiles:e.options.maxNumberOfFiles,acceptFileTypes:e.options.acceptFileTypes,maxFileSize:e.options.maxFileSize,minFileSize:e.options.minFileSize},limitConcurrentUploads:3,disableImageLoad:!0,disableImageResize:!0,disableImagePreview:!0,disableAudioPreview:!0,disableVideoPreview:!0,uploadTemplateId:null,downloadTemplateId:null,add:function(t,o){e._add(o)},submit:function(t,o){return e._start(o),!1}}).on("fileuploadprogress",function(t,o){e._progress(o)}).on("fileuploadfail",function(t,o){var i=o.files[0];e.queue[i.hash].error=e.options.str_uploading_failed,e.queue[i.hash].status.type="upload-failed",e._isFinished(i)}).on("fileuploaddone",function(t,o){e._done(o)})},_add:function(t){var o=this;e.each(t.files,function(e,i){i.hash=i.name.hashCode(),i.listtoken=o.options.listtoken,"webkitRelativePath"in i?(i.path=i.webkitRelativePath.replace(i.name,""),""!==i.path&&(o.options.pre_process=!0,o.pre_process_completed=!1)):i.path="",i=o._validate(i),o.queue[i.hash]=i,o.queue[i.hash].status={type:"upload-waiting",progress:0,progressbar:null,request:null},o.queue[i.hash].element=o.addFileToQueueTable(i),o.queue_size+=i.size,o.queue_length++,i.error&&(o.queue[i.hash].status.type="upload-failed"),o.updateFileInQueueTable(i),o.element.trigger("useyourdrive-add-upload",[i,t,o]),o._log("UPLOAD BOX: FILE ADDED")}),o.element.one("useyourdrive-upload-start",function(){t.process().done(function(){t.submit()})}),o.options.auto_upload&&window.setTimeout(function(){o._log("UPLOAD BOX: AUTO UPLOAD"),o.element.trigger("useyourdrive-upload-start")},500)},_validate:function(e){var t=this;return e.error=!1,e.name.length&&!t.options.restrictions.accepted_formats.test(e.name)?e.error=t.options.str_filetype_not_allowed:""!==t.options.restrictions.min_file_size&&e.size<=t.options.restrictions.min_file_size?e.error=t.options.str_min_file_size:t.options.restrictions.max_file_size>-1&&e.size>0&&e.size>t.options.restrictions.max_file_size?e.error=t.options.str_max_file_size:t.options.restrictions.max_uploads>0&&t.queue_length>0&&t.queue_length>=t.options.restrictions.max_uploads&&(e.error=t.options.str_files_limit),t._log("UPLOAD BOX: VALIDATED",e),e},_delete:function(e){},_start:function(t){var o=this;if(o._log("UPLOAD BOX: START",t),e.each(t.files,function(i,s){e.isEmptyObject(o.queue[s.hash])?s.error=!0:o.updateFileInQueueTable(s),!1!==s.error&&t.files.splice(i,1)}),0!==t.files.length){null===o.upload_process&&(o.upload_process=e.Deferred(),e.when(o.upload_process).then(function(){o._log("UPLOAD BOX: ALL UPLOADS FINISHED",t),o._postProcess().then(function(e){o._finish(t,e)})})),window.onbeforeunload=function(){return!0},o.element.addClass("--is-uploading");var i=t.files[0];o.queue[i.hash].status.type="upload-starting",o.updateFileInQueueTable(i),o.pending_uploads[i.hash]=i,setTimeout(function(){o._preProcess().then(function(){o.pre_process_completed=!0,o.pre_process=null,o._log("UPLOAD BOX: PREPROCESS COMPLETED"),o.element.trigger("useyourdrive-start-upload",[i,t,o]);var s=o.options.queue_table.scrollTop();s+=o.queue[i.hash].element.position().top,clearTimeout(o.tablescroller),o.tablescroller=setTimeout(function(){o.options.queue_table.animate({scrollTop:s},800)},500),o.options.support_xhr?o._getUploadUrl(i).then(function(s){if(e.isEmptyObject(s)||void 0===s.result||void 0===s.url)return o.queue[i.hash].error=o.options.str_uploading_failed,o._isFinished(i),!1;t.url=s.url,o.queue[i.hash].convert=s.convert,t.jqXHR=o.queue[i.hash].status.request=o.upload_box.fileupload("send",t),o._log("UPLOAD BOX: UPLOAD DIRECTLY TO CLOUD",t)},function(e){return o.queue[i.hash].error=o.options.str_uploading_failed,o._isFinished(i),!1}):(t.formData={action:"useyourdrive-upload-file",account_id:o.options.account_id,type:"do-upload",hash:i.hash,file_path:i.path,lastFolder:o.options.main.element.attr("data-id"),listtoken:o.options.listtoken,_ajax_nonce:o.options.upload_nonce},o._log("UPLOAD BOX: UPLOAD TO SERVER"),t.jqXHR=o.queue[i.hash].status.request=o.upload_box.fileupload("send",t))},function(){o.pre_process=null,o.pre_process_completed=!1,o._log("UPLOAD BOX: PREPROCESS FAILED");var e=t.files[0];return o.queue[e.hash].error=o.options.str_uploading_failed,o._isFinished(e),!1})},500)}else o._refreshView()},_preProcess:function(){var t=this;if(!1===t.options.pre_process||t.pre_process_completed)return new Promise(function(e,t){e(!0)});if(null!==t.pre_process)return t.pre_process;var o=e.map(t.pending_uploads,function(e){return{hash:e.hash,name:e.name,type:e.type,path:e.path}});return t.pre_process=e.ajax({type:"POST",url:t.options.ajax_url,data:{action:"useyourdrive-upload-file",account_id:t.options.main.element.attr("data-account-id"),type:"upload-preprocess",files:o,listtoken:t.options.listtoken,lastFolder:t.options.main.element.attr("data-id"),_ajax_nonce:t.options.upload_nonce},dataType:"json"}),t._log("UPLOAD BOX: PREPROCESS STARTED",t.pre_process),t.pre_process},_getUploadUrl:function(t){var o=this;return o._log("UPLOAD BOX: OBTAIN DIRECT UPLOAD URL",t),e.ajax({type:"POST",url:UseyourDrive_vars.ajax_url,data:{action:"useyourdrive-upload-file",account_id:o.options.main.options.account_id,type:"get-direct-url",filename:t.name,file_size:t.size,file_path:t.path,mimetype:t.type,orgin:window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),lastFolder:o.options.main.element.attr("data-id"),listtoken:o.options.listtoken,_ajax_nonce:o.options.upload_nonce},dataType:"json"})},_done:function(t){var o=this,i=t.files[0];!1===o.options.support_xhr&&void 0!==o.queue[i.hash].status.server_progress&&o.queue[i.hash].status.server_progress.abort();var s=!0;if(!o.options.support_xhr||void 0!==t.result&&null!==t.result||(s=!1),!1!==o.options.support_xhr||void 0!==t.result.file&&void 0!==t.result.file.fileid||(s=!1),!1===s)return o.queue[i.hash].error=o.options.str_uploading_failed,o.queue[i.hash].status.type="upload-failed",void o._isFinished(i);o.queue[i.hash].fileid=o.options.support_xhr?t.result.id:t.result.file.fileid,o.queue[i.hash].convert=o.options.support_xhr?o.queue[i.hash].convert:t.result.file.convert,i=o.queue[i.hash],o._convert(i).then(function(t){if(e.isEmptyObject(t)||void 0===t.result||0===t.result)return o.queue[i.hash].error=o.options.str_uploading_convert_failed,o._isFinished(i),!1;o.queue[i.hash].status.type="upload-finished",o.queue[i.hash].fileid=t.fileid,o.finished_uploads[o.queue[i.hash].fileid]=o.queue[i.hash],sendDriveGooglePageView("Upload file",o.queue[i.hash].name),o._isFinished(i)})},_convert:function(t){var o=this;return!1===t.convert?new Promise(function(e,o){var i={result:1,fileid:t.fileid};e(i)}):(o.queue[t.hash].status.type="upload-converting",o.updateFileInQueueTable(t),o._log("UPLOAD BOX: START CONVERT",t),e.ajax({type:"POST",url:UseyourDrive_vars.ajax_url,data:{action:"useyourdrive-upload-file",account_id:o.element.attr("data-account-id"),type:"upload-convert",listtoken:o.options.listtoken,fileid:t.fileid,convert:t.convert,_ajax_nonce:o.options.upload_nonce},dataType:"json"}))},_isFinished:function(e){var t=this;t._log("UPLOAD BOX: FILE UPLOAD FINISHED",e),t.updateFileInQueueTable(e),delete t.pending_uploads[e.hash],0===Object.keys(t.pending_uploads).length&&t.upload_process.resolve("upload-finished")},_postProcess:function(){var t=this;return t._log("UPLOAD BOX: POST PROCESS STARTED"),e.ajax({type:"POST",url:t.options.ajax_url,data:{action:"useyourdrive-upload-file",account_id:t.element.attr("data-account-id"),type:"upload-postprocess",listtoken:t.options.listtoken,files:Object.keys(t.finished_uploads),lastFolder:t.element.attr("data-id"),_ajax_nonce:t.options.upload_nonce},dataType:"json"})},_finish:function(t,o){var i=this;i._log("UPLOAD BOX: POST PROCESS FINISHED",o),window.onbeforeunload=null,i.upload_process=null,e.each(o.files,function(e,t){i.files_storage[e]={hash:e,name:t.name,type:t.type,path:t.completepath,size:t.filesize,link:t.link,account_id:t.account_id,folderurl:t.folderurl}}),i.element.find(".fileupload-filelist").val(JSON.stringify(i.files_storage)).trigger("change"),i.element.removeClass("--is-uploading"),i._refreshView(),!1===i.options.standalone&&!1===i.options.main.element.hasClass("upload")&&(i.options.main.options.clearLocalCache=!0,i.options.main.options.forceRefresh=!0,clearTimeout(i.options.main.updateTimer),i.options.main._getFileList({})),i.element.trigger("useyourdrive-upload-finished",[t,i])},_progress:function(e){var t=this;t._log("PROGRESS",e);var o,i=e.files[0];t.options.support_xhr?(o=parseInt(e.loaded/e.total*100,10),t.queue[i.hash].status.type="uploading-to-cloud"):(o=parseInt(e.loaded/e.total*100,10)/2,t.queue[i.hash].status.type="uploading-to-server",o>=50&&(o=50,t.queue[i.hash].status.type="uploading-to-cloud",setTimeout(function(){t._watchServerProgres(i)},2e3))),t.queue[i.hash].status.progress=o>0?o-1:o,t.updateFileInQueueTable(i)},_watchServerProgres:function(t){var o=this;o._getServerProgress(t).then(function(i){o._log("UPLOAD BOX: RECEIVED STATUS UPLOAD SERVER -> CLOUD",i),e.isEmptyObject(i)||void 0===i.status||"upload-failed"===i.status.progress||(o.queue[t.hash].status.type=i.status.progress,o.queue[t.hash].status.progress=50+i.status.percentage/2-1,o.updateFileInQueueTable(t),"upload-finished"!==i.status.progress&&setTimeout(function(){"upload-failed"!==o.queue[t.hash].status.type&&"upload-finished"!==o.queue[t.hash].status.type&&o._watchServerProgres(t)},2e3))})},_getServerProgress:function(t){var o=this;return o._log("UPLOAD BOX: GET STATUS UPLOAD SERVER -> CLOUD",t),o.queue[t.hash].status.server_progress=e.ajax({type:"POST",url:o.options.ajax_url,data:{action:"useyourdrive-upload-file",account_id:o.element.attr("data-account-id"),type:"get-status",listtoken:o.options.listtoken,hash:t.hash,_ajax_nonce:o.options.upload_nonce},dataType:"json"}),o.queue[t.hash].status.server_progress},_stop:function(e){var t=this;t._log("UPLOAD BOX: ABORT UPLOAD",e),t.queue[e.hash].status.request.abort(),t.queue[e.hash].status.type="upload-failed",t.queue[e.hash].error=e.error=t.options.str_uploading_cancelled},_clear:function(){var e=this;e.upload_process=null,e.pre_process=null,e.pre_process_completed=!1,e.pending_uploads={},e.finished_uploads={},e.files_storage={},e.queue=[],e.queue_length=0,e.queue_size=0,e.in_form&&(e.form_element.find(".fileupload-filelist").val(""),e.form_upload_button.remove(),e.form_upload_button=null,e._addFormSubmitButton()),e.options.queue_table.find("tr:not(.fileupload-table-row-template)").remove(),e._refreshView(),e._log("UPLOAD BOX: CLEAR UPLOAD BOX")},_log:function(e){var t=this;t.options.debug&&console.log(e)},addFileToQueueTable:function(e){var t=this,o=t.options.template_row.clone().removeClass("fileupload-table-row-template").addClass("--upload-waiting");return o.attr("data-id",e.hash),o.find(".fileupload-table-text-title").text(e.path.replace(e.name,"")+e.name),"undefined"!==e.size&&e.size>0&&o.find(".fileupload-table-text-subtitle").text(t.options.main._helperFormatBytes(e.size,1)),o.find(".fileupload-table-cell-icon img").attr("src",t._getThumbnail(e)),t.queue[e.hash].status.progressbar=new ldBar(o.find(".fileupload-loading-bar")[0],{preset:"circle",value:0}),t.options.queue_table.append(o),o},updateFileInQueueTable:function(e){var t=this,o=t.queue[e.hash].element;o.removeClass("--upload-waiting --upload-starting --uploading-to-cloud --uploading-to-server --upload-converting"),o.addClass("--"+t.queue[e.hash].status.type),t._log(t.queue[e.hash],t.queue[e.hash].status.progress),"uploading-to-cloud"!==t.queue[e.hash].status.type&&"uploading-to-server"!==t.queue[e.hash].status.type||t.queue[e.hash].status.progressbar.set(t.queue[e.hash].status.progress),!1!==e.error&&(o.find(".fileupload-table-text-subtitle").text(e.error),o.addClass("--upload-failed"),t.queue_size-=e.size,t.queue_length--),t._refreshView()},removeFileFromQueueTable:function(t){var o=this,i=o.queue[t.hash].element;i.removeClass("--upload-waiting"),i.animate({opacity:"0"},"slow",function(){e(this).remove()}),!1===i.hasClass("--upload-failed")&&!1===i.hasClass("--upload-finished")&&(o.queue_size-=t.size,o.queue_length--),o.element.trigger("useyourdrive-upload-removed",[t,o]),delete o.queue[t.hash],o._refreshView()},_refreshView:function(){var e=this;e.element.removeClass("--has-queue"),e.queue_length>0&&e.element.addClass("--has-queue"),e.queue_length>0&&(e.element.find(".fileupload-items").text(e.queue_length+" "+(1===e.queue_length?e.options.str_item:e.options.str_items)),e.element.find(".fileupload-items-size").text(e.options.main._helperFormatBytes(e.queue_size,1)));var t=e.element.find(".fileupload-start-button");t.prop("disabled",null!==e.upload_process),null!==e.upload_process?t.html('<i class="fas fa-cog fa-spin fa-fw"></i><span> '+e.options.str_uploading+"</span>"):t.html("<span> "+e.options.str_uploading_start+"</span>"),!1===e.options.auto_upload&&e.element.find(".fileupload-add-button").prop("disabled",null!==e.upload_process),e._updateRequiredUI()},_initFunctions:function(){var t=this;t.element.find(".upload-add-file, .fileupload-header-title").click(function(e){e.preventDefault(),e.stopPropagation(),t.element.find(".upload-input.upload-input-files").trigger("click"),tippy.hideAll()}),t.element.find(".upload-add-folder").click(function(e){e.preventDefault(),e.stopPropagation(),t.element.find(".upload-input.upload-input-folder").trigger("click"),tippy.hideAll()});var o=t.element.find(".fileupload-add-button");if(1===o.next().find("li").length?o.click(function(){t.element.find(".upload-add-file:first").trigger("click")}):(o.next().removeClass("tippy-content-holder"),tippy(o.get(0),{trigger:"click",content:o.next().get(0),allowHTML:!0,placement:"bottom-end",moveTransition:"transform 0.2s ease-out",interactive:!0,interactiveDebounce:500,theme:"wpcloudplugins-"+t.options.content_skin,onShown:function(e){},onCreate:function(e){}})),e(t.element).on("click",".upload-remove",function(o){o.preventDefault(),o.stopPropagation();var i=e(this).closest(".fileupload-table-row").attr("data-id"),s=t.queue[i];t.removeFileFromQueueTable(s)}),t.element.find(".fileupload-start-button").click(function(e){e.preventDefault(),e.stopPropagation(),t.element.trigger("useyourdrive-upload-start")}),e(t.element).on("click",".upload-stop",function(o){o.preventDefault(),o.stopPropagation();var i=e(this).closest(".fileupload-table-row").attr("data-id"),s=t.queue[i];t._stop(s)}),!1===t.options.has_requirements)t.element.find(".fileupload-requirements-button").remove();else{var i=t.element.find(".fileupload-requirements-button");i.next().removeClass("tippy-content-holder"),tippy(i.get(0),{content:i.next().get(0),allowHTML:!0,moveTransition:"transform 0.2s ease-out",theme:"wpcloudplugins-"+t.options.content_skin,onShown:function(e){},onCreate:function(e){}})}if(t.options.restrictions.max_file_size<0&&t.element.find(".max-file-size").text(t.options.str_uploading_no_limit),t.options.standalone&&-1==document.cookie.indexOf("UYD-ID=")){var s=new Date;s.setTime(s.getTime()+6048e5);var n="; expires="+s.toUTCString(),a=Math.random().toString(36).substr(2,16);document.cookie="UYD-ID="+a+n+"; path="+t.options.cookie_path+"; domain="+t.options.cookie_domain+";"}t._initDragDrop(),t.in_form&&t._initFormActions()},_initFormActions:function(){var t=this;t.element.addClass("--is-formfield"),t._addFormSubmitButton(),t._updateRequiredUI(),t._initCustomFolderNames(),t.options.auto_upload=t.element.hasClass("force_auto_upload")||!1,t.element.on("useyourdrive-add-upload useyourdrive-upload-removed",function(){t._updateRequiredUI()}),t.form_element.find("input, textarea").on("input change",function(){t._updateRequiredUI()}),t.element.find(".fileupload-filelist").change(function(){t.options.main.element.parent().next(".fileupload-input-filelist").val(e(this).val())}),t.element.on("useyourdrive-upload-finished",function(){e(".UseyourDrive .--is-uploading").length>0||t.form_upload_button.trigger("click")});var o=e(t.element).closest(".wpcf7");o.length>0&&o.get(0).addEventListener("wpcf7submit",function(e){t.form_element.removeClass("--is-submitting")},!1);var i=e(t.element).closest(".wpforms-form");i.length>0&&(t.form_element.on("invalid-form wpformsAjaxSubmitError wpformsAjaxSubmitFailed",function(e){t.form_element.removeClass("--is-submitting")}),t.form_element.on("wpformsPageChange",function(e,o,i){t.form_element.removeClass("--is-submitting"),t.form_upload_button.removeClass("--wpcp-submit-done"),t.form_submit_button.addClass("--wpcp-submit-hidden"),t._refreshView()})),t.form_element.on("reset",function(){t._clear()}),t._prefillQueue()},_updateRequiredUI:function(){var e=this;!1!==e.in_form&&(e.options.is_required=e.element.closest(".gfield_contains_required").length||e.element.closest(".wpcf7-validates-as-required").length||e.element.closest(".wpforms-field").find(".wpforms-required-label").length,e.options.is_required&&e.element.addClass("--is-required"),e.element.hasClass("--is-uploading")||(e.element.removeClass("--need-files --has-files"),e.options.is_required&&0===e.element.find(".--upload-waiting").length&&0===Object.keys(e.finished_uploads).length?(e.element.addClass("--need-files"),e.form_upload_button.prop("disabled",!0)):(e.element.addClass("--has-files"),e.form_upload_button.prop("disabled",!1))))},_addFormSubmitButton:function(){var e=this;e.form_submit_button.addClass("wpcp-submit-original --wpcp-submit-hidden"),e.form_upload_button=e.form_submit_button.clone().attr("id","wpcp_submit_replacement_"+e.options.listtoken).attr("onclick",null).attr("onkeypress",null).prop("onclick",null).prop("onkeypress",null).off().addClass("wpcp-upload-submit wpcf7-submit").removeClass("wpcp-submit-original --wpcp-submit-hidden").insertBefore(e.form_submit_button).click(function(t){e._formSubmitEvent(t)})},_formSubmitEvent:function(t){var o=this;if(t.stopPropagation(),t.preventDefault(),e.isFunction(o.form_element.valid)&&!1===o.form_element.valid())return!1;if(o.element.removeClass("--need-files"),o.options.is_required&&0===o.element.find(".--upload-waiting").length&&0===Object.keys(o.finished_uploads).length)return o.element.addClass("--need-files"),e("html, body").animate({scrollTop:o.element.offset().top},1500),!1;if(o.form_upload_button.prop("disabled",!1).removeClass("--wpcp-submit-active"),o.element.find(".--upload-waiting").length>0)return o.form_upload_button.val(o.options.str_uploading).html(o.options.str_uploading).prop("disabled",!0).addClass("--wpcp-submit-active"),o.element.trigger("useyourdrive-upload-start"),!1;if(o.form_upload_button.val(o.form_submit_button.val()).html(o.form_submit_button.html()).addClass("--wpcp-submit-done"),o.element.find(".--upload-waiting").length>0||o.element.find(".--need-files").length>0||e(".UseyourDrive .--is-uploading").length>0)return!1;if(o.form_upload_button.next(".wpcp-upload-submit").length>0)o.form_upload_button.next(".wpcp-upload-submit").trigger("click");else{var i=[];if(o.form_element.find(".upload-input").each(function(){i.push({parent:e(this).parent(),input:e(this).clone(!0)}),e(this).remove()}),o.element.hasClass("--is-submitting"))return!1;o.form_element.addClass("--is-submitting"),o.form_submit_button.removeClass("--wpcp-submit-hidden").trigger("click"),e("html, body").animate({scrollTop:o.form_submit_button.offset().top},1500),e.each(i,function(){this.parent.append(this.input)})}},_prefillQueue:function(){var t=this,o=t.element.find('input[name="fileupload-filelist_'+t.options.listtoken+'"]');0!==o.val().length&&(t.finished_uploads=JSON.parse(o.val()),e.each(t.finished_uploads,function(e,o){t.queue[o.hash]=o,t.queue[o.hash].status={type:"upload-finished",progress:100,progressbar:null,request:null},t.queue[o.hash].size=t.options.main._helperReturnBytes(o.size),t.queue[o.hash].error=!1,t.queue[o.hash].element=t.addFileToQueueTable(o),t.queue_size+=o.size,t.queue_length++,t.element.trigger("useyourdrive-add-upload",[o,[],t]),t.updateFileInQueueTable(o)}),t._refreshView())},_initCustomFolderNames:function(){var t=this,o=t.form_element.find("input.useyourdrive_private_folder_name, .useyourdrive_private_folder_name input:last");0!==o.length&&(null===t.block_upload_element&&(t.block_upload_element=e("<div>").attr("class","fileupload-box-block").html("<div>"+t.options.str_uploading_required_data+"</div>"),t.block_upload_element.insertBefore(t.element.css("position","relative"))),t.block_upload_element.show(),o.keyup(function(){var i="";o.each(function(){i+=e(this).val()+"|"}),i=i.length>0?i.slice(0,-1):i,i.length>2?(t.block_upload_element.fadeOut(),document.cookie="WPCP-FORM-NAME-"+t.options.listtoken+"="+i+"; path=/"):t.block_upload_element.fadeIn()}),o.trigger("keyup"))},_initDragDrop:function(){var t=this;e(document).bind("dragover",function(o){var i=t.options.dropzone,s=t.dropZoneTimeout;s?clearTimeout(s):i.addClass("in");var n=!1,a=o.target;do{if(e(a).is(i)){n=!0;break}a=a.parentNode}while(null!==a);n?e(a).addClass("hover"):i.removeClass("hover"),t.dropZoneTimeout=setTimeout(function(){t.dropZoneTimeout=null,i.removeClass("in hover")},100)}),e(document).bind("drop dragover",function(e){e.preventDefault()})},_getThumbnail:function(e){var t,o=this,i=o.options.icons_set;return void 0===e.thumbnail||null===e.thumbnail||""===e.thumbnail?(t=void 0===e.type||null===e.type?"icon_11_generic_xl128":e.type.indexOf("word")>=0?"icon_11_word_xl128":e.type.indexOf("excel")>=0||e.type.indexOf("spreadsheet")>=0?"icon_11_excel_xl128":e.type.indexOf("powerpoint")>=0||e.type.indexOf("presentation")>=0?"icon_11_powerpoint_xl128":e.type.indexOf("image")>=0?"icon_11_image_xl128":e.type.indexOf("audio")>=0?"icon_11_audio_xl128":e.type.indexOf("video")>=0?"icon_11_video_xl128":e.type.indexOf("pdf")>=0?"icon_11_pdf_xl128":e.type.indexOf("text")>=0?"icon_11_text_xl128":"icon_11_generic_xl128",i+t+".png"):e.thumbnail}})})(jQuery);